<script>
import { __ } from '~/locale';
import { GlEmptyState, GlSkeletonLoading, GlTable } from '@gitlab/ui';
import SeverityBadge from 'ee/vue_shared/security_reports/components/severity_badge.vue';

export default {
  name: 'VulnerabilityList',
  components: {
    GlEmptyState,
    GlSkeletonLoading,
    GlTable,
    SeverityBadge,
  },
  props: {
    dashboardDocumentation: {
      type: String,
      required: true,
    },
    emptyStateSvgPath: {
      type: String,
      required: true,
    },
    vulnerabilities: {
      type: Array,
      required: true,
    },
    isLoading: {
      type: Boolean,
      required: false,
      default: false,
    },
  },
  methods: {
    vulnerabilityPath({ id }) {
      /*
       * We shouldn't do this here, but there's no way to get this url from the
       * data just yet.
       */
      return `vulnerabilities/${id}`;
    },
  },
  fields: [
    {
      key: 'state',
      label: __('Status'),
      thClass: 'gl-w-64',
    },
    {
      key: 'severity',
      label: __('Severity'),
      thClass: 'gl-w-64',
    },
    {
      key: 'title',
      label: __('Description'),
    },
  ],
};
</script>

<template>
  <gl-table
    :busy="isLoading"
    :fields="$options.fields"
    :items="vulnerabilities"
    stacked="sm"
    show-empty
    responsive
  >
    <template #cell(state)="{ item }">
      <span class="text-capitalize">{{ item.state }}</span>
    </template>

    <template #cell(severity)="{ item }">
      <severity-badge :severity="item.severity" />
    </template>

    <template #cell(title)="{ item }">
      <a class="text-body" :href="vulnerabilityPath(item)">{{ item.title }}</a>
    </template>

    <template #table-busy>
      <gl-skeleton-loading v-for="n in 10" :key="n" class="m-2 js-skeleton-loader" :lines="2" />
    </template>

    <template #empty>
      <slot name="emptyState">
        <gl-empty-state
          :title="s__(`We've found no vulnerabilities`)"
          :description="
            s__(
              `While it's rare to have no vulnerabilities, it can happen. In any event, we ask that you please double check your settings to make sure you've set up your dashboard correctly.`,
            )
          "
        />
      </slot>
    </template>
  </gl-table>
</template>
